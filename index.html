<!DOCTYPE html>
<html lang="en">
<head>
<base href=".">
<title>UAudio Amp Library</title>
<meta name="description" content="UAudio pedal tone settings manager and library">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dom-to-image/2.6.0/dom-to-image.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>
* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

html {
  overflow-y: scroll;
}

body {
  background: #1a1a1a;
  color: #fff;
  font-family: Arial, sans-serif;
  padding: 20px;
}

.app-header {
  text-align: center;
  padding: 20px 0 40px;
  background: linear-gradient(to right, #1a1a1a, #2a2a2a);
  margin-bottom: 20px;
  border-bottom: 1px solid #333;
}

.app-header h1 {
  font-size: 2.5em;
  color: #fff;
  margin-bottom: 10px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.app-header .tagline {
  color: #999;
  font-size: 1.1em;
  font-style: italic;
}

#donate-button-container {
  margin: 20px auto 0;
  text-align: center;
  position: static;
}

.pedal-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  padding: 20px;
}

.pedal {
  background: #2a2a2a;
  border-radius: 10px;
  padding: 20px;
  width: 300px;
  position: relative;
}

.pedal-interface {
  display: block;
}

.uafx-controls-interface {
    display: none; /* Initially hidden */
    width: 100%;
    height: 400px; /* Same height as pedal-image */
    background-color: #111; /* Slightly lighter than black for visibility */
    border-radius: 5px; /* Optional: match pedal image style */
    margin-bottom: 10px; /* Adjust spacing if needed */
    padding: 15px;
    color: #eee;
    font-size: 14px;
    overflow-y: auto; /* Allow scrolling if content overflows */
    overflow-x: hidden;     /* Prevent horizontal scroll */
    width: 70w;           /* Lock width to viewport */
    position: relative;     /* Ensures stable box model */
}

.pedal-image {
  width: 100%;
  height: 400px;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  position: relative;
}

.knob-container {
  position: absolute;
  width: 40px;
  height: 40px;
  cursor: move;
  z-index: 100;
}

.knob {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: #444;
  position: relative;
  cursor: pointer;
  transform-origin: center center;
  transition: transform 0.1s;
  user-select: none;
  -webkit-user-select: none;
  touch-action: none;
}

.knob::after {
  content: '';
  position: absolute;
  width: 2px;
  height: 50%;
  background: #fff;
  left: 50%;
  transform: translateX(-50%);
}

.pedal h2 {
  text-align: center;
  margin-bottom: 10px;
  color: #ddd;
}

.controls {
  margin-top: 10px;
  text-align: center;
}

.value-display {
  display: none;
}

/* Button styles */
.button-group {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 15px;
}

.save-button,
.import-button,
.add-favorite-button,
.show-favorites-button {
  display: block;
  width: 100%;
  margin: 0 auto;
  padding: 10px 20px;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.3s;
}

.save-button:hover,
.import-button:hover,
.add-favorite-button:hover,
.show-favorites-button:hover {
  background: #666;
}

.uafx-controls-button {
  display: block;
  width: 100%;
  margin: 0 auto;
  padding: 10px 20px;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;

}

.uafx-controls-button:hover {
  background: #777;
  transition: background 0.3s;
}

/* LED styles */
.led-container {
  position: absolute;
  top: 28.65%;
  left: 9.5%;
  display: flex;
  flex-direction: column;
  gap: 5px;
  align-items: center;
}

.led-container.second-led-set {
  position: absolute;
  top: 28.65%;
  left: 87%;
  display: flex;
  flex-direction: column;
  gap: 5px;
  align-items: center;
}

.led-container.second-led-set .radio-button {
  position: absolute;
  order: -1;
  margin-right: 43px;
}

.led-container.second-led-set .led {
  margin-left: 0;
}

.led {
  width: 8.71px;
  height: 8.71px;
  border-radius: 50%;
  background-color: black;
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.led.red {
  background: radial-gradient(circle at center,
    #ffeb3b 0%,
    #ff5722 40%,
    #f44336 100%);
  box-shadow: 0 0 5px 2px rgba(255, 0, 0, 0.7);
}

.led.green {
  background: radial-gradient(circle at center,
    #b2ff59 0%,
    #4caf50 40%,
    #2e7d32 100%);
  box-shadow: 0 0 5px 2px rgba(0, 255, 0, 0.7);
}

.led.amber {
  background: radial-gradient(circle at center,
    #ffca28 0%,
    #ffa000 40%,
    #ff6f00 100%);
  box-shadow: 0 0 5px 2px rgba(255, 165, 0, 0.7);
}

.led.led-cyan {
  background: radial-gradient(circle at center,
    #00ffff 0%,
    #00cccc 40%,
    #009999 100%);
  box-shadow: 0 0 5px 2px rgba(0, 255, 255, 0.7);
}

.radio-button {
  position: absolute;
  top: 50%;
  transform: translateY(-51%);
  margin-left: 43px;
}

.led-container.second-led-set .radio-button {
  margin-left: 0;
}

.save-button {
  margin: 0;
}

/* Favorites page styles */
.favorites-container {
  padding: 20px;
  display: none;
}

.favorites-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.header-buttons {
  display: flex;
  gap: 10px;
}

.export-all-button {
  padding: 10px 20px;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
}

.export-all-button:hover {
  background: #666;
}

.back-button {
  padding: 10px 20px;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
}

.back-button:hover {
  background: #666;
}

.favorites-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
}

.favorite-item {
  background: #2a2a2a;
  border-radius: 10px;
  padding: 15px;
  position: relative;
  cursor: pointer;
  transition: transform 0.2s;
}

.favorite-item:hover {
  transform: scale(1.02);
}

/* Add tooltip hint */
.favorite-item::after {
  content: 'Double-click to restore settings';
  position: absolute;
  bottom: -30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.8);
  padding: 5px 10px;
  border-radius: 4px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
}

.favorite-item:hover::after {
  opacity: 1;
}

.favorite-item img {
  width: 100%;
  height: auto;
  border-radius: 5px;
}

.favorite-title {
  margin: 10px 0;
  color: #fff;
  text-align: center;
}

/* Add styles for the pedal name display */
.favorite-pedal-name {
  color: #888;
  font-size: 0.9em;
  text-align: center;
  margin-top: 5px;
}

.delete-favorite {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #ff4444;
  color: white;
  border: none;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  transition: opacity 0.3s, background-color 0.3s;
  opacity: 0;
}

.favorite-item:hover .delete-favorite {
  opacity: 1;
}

.delete-favorite:hover {
  background: #ff0000;
}

/* Add styles for preset name display */
.preset-name {
  text-align: center;
  color: #888;
  margin-top: 10px;
  margin-bottom: 10px;
  font-style: italic;
}

/* Toggle Button Styles */
.toggle-button {
  display: flex;
  align-items: center;
  margin-bottom: 10px;
}

.toggle-button label {
  margin-right: 10px;
  color: #ccc;
}

.toggle-switch {
  position: relative;
  display: inline-block;
  width: 50px;
  height: 24px;
}

.toggle-switch input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #333;
  transition: .4s;
  border-radius: 24px;
}

.toggle-slider:before {
  position: absolute;
  content: "";
  height: 16px;
  width: 16px;
  left: 4px;
  bottom: 4px;
  background-color: white;
  transition: .4s;
  border-radius: 50%;
}

.toggle-switch input:checked + .toggle-slider {
  background-color: #00ccff;
}

.toggle-switch input:checked + .toggle-slider:before {
  transform: translateX(26px);
}

/* Slider Styles */
.slider-control {
  margin-bottom: 15px;
}

.slider-control label {
  display: block;
  color: #ccc;
  margin-bottom: 5px;
}

.slider-bounds {
  display: flex;
  justify-content: space-between;
  font-size: 12px;
  color: #888;
  margin-top: 2px;
}

.slider {
  -webkit-appearance: none;
  width: 100%;
  height: 4px;
  background: #333;
  outline: none;
  border-radius: 2px;
}

.slider::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  background: #00ccff;
  cursor: pointer;
  border-radius: 50%;
}

.slider::-moz-range-thumb {
  width: 16px;
  height: 16px;
  background: #00ccff;
  cursor: pointer;
  border-radius: 50%;
}

/* Add to existing CSS */
.knob-container.secondary {
  transform: scale(1.5);
  opacity: 0.6;
  z-index: 90;
}

/* Styles for UAFX Controls Interface Elements */
.uafx-control-group {
  margin-bottom: 15px;
  padding-bottom: 10px;
  border-bottom: 1px solid #444;
}

.uafx-control-group:last-child {
    border-bottom: none;
}

.uafx-control-group h4 {
  margin-bottom: 8px;
  color: #aaa;
  font-size: 1em;
}

.uafx-button-group {
  display: flex;
  gap: 10px;
}

.uafx-button-group-vert {
  display: flex;
  flex-direction: column;
  gap: 10px; /* optional: adds space between buttons */
  align-items: stretch; /* optional: makes all buttons equal width */
}

.uafx-button-group button,
.uafx-button-group-vert button,
.uafx-toggle-button {
  flex: 1;
  padding: 5px 10px;
  background: #444;
  color: #fff;
  border: 1px solid #555;
  border-radius: 4px;
  cursor: pointer;
  font-size: 0.9em;
  transition: background 0.2s, border-color 0.2s;
}

.uafx-button-group button:hover,
.uafx-button-group-vert button:hover,
.uafx-toggle-button:hover {
  background: #555;
}

.uafx-button-group button.active,
.uafx-button-group-vert button.active,
.uafx-toggle-button.active {
  background: #00ccff; /* Cyan color for active state */
  border-color: #4dd0e1;
  color: #111;
  font-weight: bold;
}

.uafx-slider-group {
    display: flex;
    flex-direction: column;
    gap: 5px;
}

.uafx-slider-container {
    display: flex;
    align-items: center;
    margin-bottom: 10px;
}

.uafx-slider-container label {
    width: 80px; /* Set to desired width */
    margin-right: 10px;
    text-align: left;
    font-size: 0.9em;
    color: #ccc;
}

.uafx-slider-container input[type="range"] {
    flex: 1;
    cursor: pointer;
    appearance: none; /* Override default look */
    width: 100%;
    height: 8px;
    background: #333;
    border-radius: 4px;
    outline: none;
}

/* Style the thumb (the draggable part) */
.uafx-slider-container input[type="range"]::-webkit-slider-thumb {
    appearance: none;
    width: 16px;
    height: 16px;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    position: relative;
    z-index: 1;
}

.uafx-slider-container input[type="range"]::-moz-range-thumb {
    width: 16px;
    height: 16px;
    background: white;
    border-radius: 50%;
    cursor: pointer;
    border: none;
}

.uafx-toggle-container {
    display: flex;
    align-items: center;
    /* justify-content: space-between; */
    margin-bottom: 10px;
}

/* 
.uafx-toggle-container label {
    font-size: 0.9em;
    color: #ccc;
}
*/

.uafx-toggle-container label:first-child {
  width: 100px; /* Or match slider label width */
  text-align: right;
  margin-right: 10px;
}


.uafx-toggle-button {
    min-width: 60px; /* Ensure ON/OFF buttons have minimum width */
    text-align: center;
}

/* Generic range input styles */
input[type="range"] {
  -webkit-appearance: none;
  width: 100%;
  height: 8px;
  border-radius: 4px;
  background: linear-gradient(to right, #00adef 50%, #555 50%);
  outline: none;
  transition: background 0.3s ease-in-out;
}

/* Update the background fill dynamically with JS */
input[type="range"]::-webkit-slider-thumb {
  -webkit-appearance: none;
  appearance: none;
  width: 16px;
  height: 16px;
  background: white;
  border-radius: 50%;
  cursor: pointer;
  z-index: 2;
  position: relative;
}

input[type="range"]::-moz-range-thumb {
  width: 16px;
  height: 16px;
  background: white;
  border-radius: 50%;
  cursor: pointer;
  border: none;
}

/* Firefox-specific styles */
input[type="range"]::-moz-range-track {
  background: #555;
  height: 8px;
  border-radius: 4px;
}

input[type="range"]::-moz-range-progress {
  background: #00adef;
  height: 8px;
  border-radius: 4px;
}


</style>
</head>
<body>
<header class="app-header">
  <h1>UAudio Amp Library</h1>
  <p class="tagline">Your Ultimate Tone Library Manager</p>
  <div id="donate-button-container">
      <div style="margin-top: 50px;"></div>
      <div id="donate-button"></div>
      <script src="https://www.paypalobjects.com/donate/sdk/donate-sdk.js" charset="UTF-8"></script>
      <script>
          PayPal.Donation.Button({
              env: 'production',
              hosted_button_id: 'KTN5H79BND7MQ',
              image: {
                  src: 'https://www.paypalobjects.com/en_US/GB/i/btn/btn_donateCC_LG.gif',
                  alt: 'Donate with PayPal button',
                  title: 'PayPal - The safer, easier way to pay online!'
              }
          }).render('#donate-button');
      </script>
    </div>
</header>
<div class="pedal-container">
  <!-- Cream '65 -->
  <div class="pedal">
    <h2>Cream &apos;65</h2>
    <div class="pedal-interface">
        <div class="main-pedal-controls"> 
            <div class="pedal-image" id="cream" style="background-image: none;">
                <div class="knob-container" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="bass"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 73.33%">
                    <div class="knob" data-param="treble"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="reverb"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="mid"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="master"></div>
                </div>
                <!-- Secondary Knobs -->
                <div class="knob-container secondary" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="mid-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="master-secondary"></div>
                </div>
                <div class="led-container">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control">
                </div>
                <div class="led-container second-led-set">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-2">
                </div>
            </div>
        </div>
        <div class="uafx-controls-interface">
            <p>UAFX Controls not yet implemented for this pedal.</p>
        </div> 
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="uafx-controls-button">uafx controls</button> 
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".cream" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Rigby '63 -->
  <div class="pedal">
    <h2>Rigby &apos;63</h2>
     <div class="pedal-interface">
        <div class="main-pedal-controls"> 
            <div class="pedal-image" id="rigby" style="background-image: none;">
                <div class="knob-container" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="tone"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 73.33%">
                    <div class="knob" data-param="bias"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="drive"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="presence"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="master"></div>
                </div>
                <!-- Secondary Knobs -->
                <div class="knob-container secondary" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="drive-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="presence-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="master-secondary"></div>
                </div>
                <div class="led-container">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-rigby">
                </div>
                <div class="led-container second-led-set">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-2-rigby">
                </div>
            </div>
        </div>
        <div class="uafx-controls-interface">
             <p>UAFX Controls not yet implemented for this pedal.</p>
        </div> 
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="uafx-controls-button">uafx controls</button> 
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".rigby" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Leo '68 -->
  <div class="pedal">
    <h2>Leo &apos;68</h2>
     <div class="pedal-interface">
        <div class="main-pedal-controls"> 
            <div class="pedal-image" id="leo" style="background-image: none;">
                <div class="knob-container" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="drive"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 73.33%">
                    <div class="knob" data-param="tone"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="presence"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="bass"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="master"></div>
                </div>
                <!-- Secondary Knobs -->
                <div class="knob-container secondary" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="presence-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="bass-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="master-secondary"></div>
                </div>
                <div class="led-container">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-leo">
                </div>
                <div class="led-container second-led-set">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-2-leo">
                </div>
            </div>
        </div>
        <div class="uafx-controls-interface leo-uafx-controls">
            <div class="uafx-control-group">
                <h4>Input Routing</h4>
                <div class="uafx-button-group" data-control-type="input-routing">
                    <button data-value="low" class="active">Low</button>
                    <button data-value="high">High</button>
                    <button data-value="jump">Jump</button>
                </div>
            </div>
            
            <div class="uafx-control-group">
              <h4>Mods</h4>
              <div class="uafx-toggle-container">
                <label for="ghost-notes-toggle">Ghost Notes</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="ghost-notes-toggle" class="ghost-notes-toggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="uafx-toggle-container">
                <label for="bright-cap-toggle">Bright Cap</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="bright-cap-toggle" class="bright-cap-toggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>
            <div class="uafx-control-group">
                <h4>Noise Gate</h4>
                <button class="uafx-toggle-button" data-control-type="noise-gate-enable" data-active="false" style="margin-bottom: 10px; width: 100%;">OFF</button>
                <div class="uafx-slider-group noise-gate-sliders" style="display: none;"> <!-- Initially hidden -->
                    <div class="uafx-slider-container">
                        <label for="leo-ng-threshold">Threshold</label>
                        <input type="range" id="leo-ng-threshold" min="0" max="100" value="50" data-control-type="ng-threshold">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="leo-ng-release">Release</label>
                        <input type="range" id="leo-ng-release" min="0" max="100" value="50" data-control-type="ng-release">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="leo-ng-attenuation">Attenuation</label>
                        <input type="range" id="leo-ng-attenuation" min="0" max="100" value="50" data-control-type="ng-attenuation">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="leo-ng-hold">Hold</label>
                        <input type="range" id="leo-ng-hold" min="0" max="100" value="50" data-control-type="ng-hold">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="uafx-controls-button">uafx controls</button> 
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".leo" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Willow '55 -->
  <div class="pedal">
    <h2>Willow &apos;55</h2>
    <div class="pedal-interface">
        <div class="main-pedal-controls"> 
            <div class="pedal-image" id="willow" style="background-image: none;">
                <div class="knob-container" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="tone"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 73.33%">
                    <div class="knob" data-param="mic"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="bass"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="mid"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="treble"></div>
                </div>
                <div class="led-container">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-willow">
                </div>
                <div class="led-container second-led-set">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-2-willow">
                </div>
            </div>
        </div>
        <div class="uafx-controls-interface">
             <p>UAFX Controls not yet implemented for this pedal.</p>
        </div> 
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="uafx-controls-button">uafx controls</button> 
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".willow" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Enigmax -->
  <div class="pedal">
    <h2>Enigmax</h2>
    <div class="pedal-interface">
        <div class="main-pedal-controls"> 
            <div class="pedal-image" id="enigmax" style="background-image: none;">
                <div class="knob-container" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="range"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 73.33%">
                    <div class="knob" data-param="filter"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="mix"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="sensitivity"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="output"></div>
                </div>
                <!-- Secondary Knobs -->
                <div class="knob-container secondary" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="range-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="mix-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="sensitivity-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="output-secondary"></div>
                </div>
                <div class="led-container">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-enigmax">
                </div>
                <div class="led-container second-led-set">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-2-enigmax">
                </div>
            </div>
        </div>
        <div class="uafx-controls-interface enigmax-uafx-controls">
            <div class="uafx-control-group">
                <h4>Amps</h4>
                <div class="uafx-button-group-vert" data-control-type="amps">
                    <button data-value="50w, high plate" class="active">50W, high plate</button>
                    <button data-value="100w, low plate, squishy ps">100W, low plate, squishy PS</button>
                    <button data-value="100w, high plate, stiff ps">100w, high plate, stiff PS</button>
                    <button data-value="100w, low plate, very stiff ps">100w, low plate, very stiff PS</button>
                </div>
            </div>
            <div class="uafx-control-group">
              <h4>Input</h4>
              <div class="uafx-button-group" data-control-type="input">
                <button data-value="normal" class="active">Normal</button>
                <button data-value="fet">FET</button>
              </div>
              <div style="height: 10px;"></div> <!-- Empty line -->
              <div class="uafx-slider-container fet-trim-slider" style="display: none;">
                <label for="enigmax-ng-fet-trim">FET Trim</label>
                <input type="range" id="enigmax-ng-fet-trim" min="0" max="100" value="50" data-control-type="ng-fet-trim">
              </div>
            </div>
            <div class="uafx-control-group">
                <h4>Overdrive</h4>
                <div class="uafx-button-group" data-control-type="overdrive">
                    <button data-value="off" class="active">OFF</button>
                    <button data-value="on">ON</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Bright Switch</h4>
                <div class="uafx-button-group" data-control-type="bright-switch">
                    <button data-value="bright-cap-off" class="active">Bright Cap Off</button>
                    <button data-value="150-pf">150 pF</button>
                    <button data-value="196-pf">196 pF</button>
                    <button data-value="300-pf">300 pF</button>
                </div>
                <h4>Deep/Mid</h4>
                <div class="uafx-button-group" data-control-type="deep-mid">
                    <button data-value="off" class="active">Off</button>
                    <button data-value="deep">Deep</button>
                    <button data-value="mid">Mid</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Tone Stack EQ</h4>
                <div class="uafx-button-group" data-control-type="tone-stack-eq">
                    <button data-value="jazz" class="active">Jazz</button>
                    <button data-value="rock">Rock</button>
                </div>
                <h4>Tone Stack Type</h4>
                <div class="uafx-button-group" data-control-type="tone-stack-type">
                    <button data-value="classic" class="active">Classic</button>
                    <button data-value="skyline">Skyline</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Preamp Boost</h4>
                <div class="uafx-button-group" data-control-type="preamp-boost">
                    <button data-value="off" class="active">OFF</button>
                    <button data-value="on">ON</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>OD Trim</h4>
                <div class="uafx-slider-group noise-gate-sliders">
                    <div class="uafx-slider-container">
                        <input type="range" id="enigmax-ng-od-trim" min="0" max="100" value="50" data-control-type="ng-post-od-trim">
                    </div>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>HRM Overdrive EQ</h4>
                <button class="uafx-toggle-button" data-control-type="hrm-eq-enable" data-active="false" style="margin-bottom: 10px; width: 100%;">OFF</button>
                <div class="uafx-slider-group hrm-eq-sliders" style="display: none;"> <!-- Initially hidden -->
                    <div class="uafx-slider-container">
                        <label for="enigmax-ng-treble">Treble</label>
                        <input type="range" id="enigmax-ng-treble" min="0" max="100" value="50" data-control-type="ng-threshold">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="enigmax-ng-mid">Mid</label>
                        <input type="range" id="enigmax-ng-mid" min="0" max="100" value="50" data-control-type="ng-attack">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="enigmax-ng-bass">Bass</label>
                        <input type="range" id="enigmax-ng-bass" min="0" max="100" value="50" data-control-type="ng-release">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="herakles-ng-attenuation">Attenuation</label>
                        <input type="range" id="herakles-ng-attenuation" min="0" max="100" value="50" data-control-type="ng-attenuation">
                    </div>                     
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Master Gain</h4>
                <div class="uafx-slider-group noise-gate-sliders">
                    <div class="uafx-slider-container">
                        <input type="range" id="aint-ng-master-gain" min="0" max="100" value="50" data-control-type="ng-post-master-gain">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="uafx-controls-button">uafx controls</button> 
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".enigmax" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Herakles -->
  <div class="pedal">
    <h2>Herakles</h2>
    <div class="pedal-interface">
        <div class="main-pedal-controls"> 
            <div class="pedal-image" id="herakles" style="background-image: none;">
                <div class="knob-container" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="gain"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 73.33%">
                    <div class="knob" data-param="tone"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="bass"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="mid"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="treble"></div>
                </div>
                <!-- Secondary Knobs -->
                <div class="knob-container secondary" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="gain-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="bass-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="mid-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="treble-secondary"></div>
                </div>
                <div class="led-container">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-herakles">
                </div>
                <div class="led-container second-led-set">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-2-herakles">
                </div>
            </div>
        </div>
        <div class="uafx-controls-interface herakles-uafx-controls">
            <div class="uafx-control-group">
                <h4>Overdrive</h4>
                <div class="uafx-button-group" data-control-type="overdrive">
                    <button data-value="ts" class="active">TS</button>
                    <button data-value="tc">TC</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Noise Gate</h4>
                <button class="uafx-toggle-button" data-control-type="noise-gate-enable" data-active="false" style="margin-bottom: 10px; width: 100%;">OFF</button>
                <div class="uafx-slider-group noise-gate-sliders" style="display: none;"> <!-- Initially hidden -->
                    <div class="uafx-slider-container">
                        <label for="herakles-ng-threshold">Threshold</label>
                        <input type="range" id="herakles-ng-threshold" min="0" max="100" value="50" data-control-type="ng-threshold">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="herakles-ng-atack">Attack</label>
                        <input type="range" id="herakles-ng-attack" min="0" max="100" value="50" data-control-type="ng-attack">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="herakles-ng-release">Release</label>
                        <input type="range" id="herakles-ng-release" min="0" max="100" value="50" data-control-type="ng-release">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="herakles-ng-attenuation">Attenuation</label>
                        <input type="range" id="herakles-ng-attenuation" min="0" max="100" value="50" data-control-type="ng-attenuation">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="herakles-ng-hold">Hold</label>
                        <input type="range" id="herakles-ng-hold" min="0" max="100" value="50" data-control-type="ng-hold">
                    </div>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Signal Flow</h4>
                <div class="uafx-button-group-vert" data-control-type="signal-flow">
                    <button data-value="preamp + tone eq" class="active">Preamp + Tone EQ</button>
                    <button data-value="tone eq + power amp">Tone EQ + Power Amp</button>
                    <button data-value="full">Full</button>
                </div>
            </div>
            
            <div class="uafx-control-group">
              <h4>Channel Style / Orange Presence</h4>
              <div class="uafx-button-group" data-control-type="channel-select">
                <button data-value="clean" class="active">Clean</button>
                <button data-value="orange-channel">Orange Channel</button>
                <button data-value="red-channel">Red Channel</button>
              </div>
              <div class="channel-style-options" style="display: none; margin-top: 10px;">
                <h4>Channel Style</h4>
                <div class="uafx-button-group" data-control-type="channel-style">
                  <button data-value="normal">Normal</button>
                  <button data-value="modern">Modern</button>
                </div>
              </div>
              <div class="channel-style-options-red" style="display: none; margin-top: 10px;">
                <h4>Red Channel Style</h4>
                <div class="uafx-button-group" data-control-type="channel-style-red">
                  <button data-value="normal">Normal</button>
                  <button data-value="vintage">Vintage</button>
                </div>
                <div class="uafx-slider-container">
                  <label for="herakles-orange-presence">Orange Presence</label>
                  <input type="range" id="herakles-orange-presence" min="0" max="100" value="50" data-control-type="orange-presence">
                </div>
              </div>
            </div>
            <div class="uafx-control-group">
                <h4>Power Tubes</h4>
                <div class="uafx-button-group" data-control-type="power-tubes">
                    <button data-value="6l6" class="active">6L6</button>
                    <button data-value="el34">EL34</button>
                </div>
                <div style="height: 10px;"></div> <!-- Empty line -->
                <h4>Rectifier Type</h4>
                <div class="uafx-button-group" data-control-type="rectifier type">
                    <button data-value="solid state" class="active">Solid State</button>
                    <button data-value="tube">Tube</button>
                </div>
                <div style="height: 10px;"></div> <!-- Empty line -->
                <h4>Power Mode</h4>
                <div class="uafx-button-group" data-control-type="power mode">
                    <button data-value="bold" class="active">Bold</button>
                    <button data-value="spongy">Spongy</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Master</h4>
                <div class="uafx-slider-group noise-gate-sliders">
                    <div class="uafx-slider-container">
                        <input type="range" id="herakles-ng-master" min="0" max="100" value="50" data-control-type="ng-master">
                    </div>
                </div>
            </div>            
        </div> 
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="uafx-controls-button">uafx controls</button> 
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".herakles" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Aint -->
  <div class="pedal">
    <h2>Aint</h2>
    <div class="pedal-interface">
        <div class="main-pedal-controls"> 
            <div class="pedal-image" id="aint" style="background-image: none;">
                <div class="knob-container" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="tone"></div>
                </div>
                <div class="knob-container" style="top: 13%; left: 73.33%">
                    <div class="knob" data-param="filter"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="mix"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="drive"></div>
                </div>
                <div class="knob-container" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="master"></div>
                </div>
                <!-- Secondary Knobs -->
                <div class="knob-container secondary" style="top: 13%; left: 11.67%">
                    <div class="knob" data-param="volume-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 13%; left: 41.67%">
                    <div class="knob" data-param="tone-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 11.67%">
                    <div class="knob" data-param="mix-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 41.67%">
                    <div class="knob" data-param="drive-secondary"></div>
                </div>
                <div class="knob-container secondary" style="top: 42%; left: 73.33%">
                    <div class="knob" data-param="master-secondary"></div>
                </div>
                <div class="led-container">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-aint">
                </div>
                <div class="led-container second-led-set">
                    <div class="led"></div>
                    <div class="led"></div>
                    <div class="led"></div>
                    <input type="radio" class="radio-button" name="led-control-2-aint">
                </div>
            </div>
        </div>
        <div class="uafx-controls-interface aint-uafx-controls">
            <div class="uafx-control-group">
                <h4>Overdrive</h4>
                <div class="uafx-button-group" data-control-type="overdrive">
                    <button data-value="ts" class="active">TS</button>
                    <button data-value="tc">TC</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Bright Switch</h4>
                <div class="uafx-button-group" data-control-type="bright-switch">
                    <button data-value="off" class="active">OFF</button>
                    <button data-value="on">ON</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Noise Gate</h4>
                <button class="uafx-toggle-button" data-control-type="noise-gate-enable" data-active="false" style="margin-bottom: 10px; width: 100%;">OFF</button>
                <div class="uafx-slider-group noise-gate-sliders" style="display: none;"> <!-- Initially hidden -->
                    <div class="uafx-slider-container">
                        <label for="aint-ng-threshold">Threshold</label>
                        <input type="range" id="aint-ng-threshold" min="0" max="100" value="50" data-control-type="ng-threshold">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="aint-ng-atack">Attack</label>
                        <input type="range" id="aint-ng-attack" min="0" max="100" value="50" data-control-type="ng-attack">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="aint-ng-release">Release</label>
                        <input type="range" id="aint-ng-release" min="0" max="100" value="50" data-control-type="ng-release">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="aint-ng-attenuation">Attenuation</label>
                        <input type="range" id="aint-ng-attenuation" min="0" max="100" value="50" data-control-type="ng-attenuation">
                    </div>
                     <div class="uafx-slider-container">
                        <label for="aint-ng-hold">Hold</label>
                        <input type="range" id="aint-ng-hold" min="0" max="100" value="50" data-control-type="ng-hold">
                    </div>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Input Routing</h4>
                <div class="uafx-button-group" data-control-type="input-routing">
                    <button data-value="high" class="active">High</button>
                    <button data-value="low">Low</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Rhythm Mode</h4>
                <div class="uafx-button-group" data-control-type="rhythm-mode">
                    <button data-value="clean" class="active">Clean</button>
                    <button data-value="punch">Punch</button>
                    <button data-value="punch+">Punch+</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Bias Mode</h4>
                <div class="uafx-button-group-vert" data-control-type="bias-mode">
                    <button data-value="cool" class="active">Cool</button>
                    <button data-value="warm">Warm</button>
                    <button data-value="cool choke">Cool Choke</button>
                    <button data-value="warm choke">Warm Choke</button>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Post Gain</h4>
                <div class="uafx-slider-group noise-gate-sliders">
                    <div class="uafx-slider-container">
                        <input type="range" id="aint-ng-post-gain" min="0" max="100" value="50" data-control-type="ng-post-gain">
                    </div>
                </div>
            </div>
            <div class="uafx-control-group">
                <h4>Room</h4>
                <div class="uafx-slider-group noise-gate-sliders">
                    <div class="uafx-slider-container">
                        <input type="range" id="aint-ng-room" min="0" max="100" value="50" data-control-type="ng-room">
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="uafx-controls-button">uafx controls</button> 
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".aint" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>
</div>

<script>
async function loadBase64Background(url, elementId, retryCount = 0) {
    try {
        const element = document.getElementById(elementId);
        if (!element) {
            console.error(`Element with ID "${elementId}" not found`);
            return;
        }

        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Cache-Control': 'no-cache',
                'Pragma': 'no-cache'
            }
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const base64Data = await response.text();

        // Check if we got actual data
        if (!base64Data || base64Data.length < 100) {
            if (retryCount < 3) {
                await new Promise(resolve => setTimeout(resolve, 500));
                return loadBase64Background(url, elementId, retryCount + 1);
            }
            return;
        }

        element.style.backgroundImage = `url(${base64Data})`;
    } catch (error) {
        console.error(`Failed to load image for ${elementId}:`, error);
    }
}

// Array of pedal configurations
const pedals = [
    { id: 'cream', url: 'cream.html' },
    { id: 'rigby', url: 'rigby.html' },
    { id: 'leo', url: 'leo.html' },
    { id: 'willow', url: 'willow.html' },
    { id: 'enigmax', url: 'enigmax.html' },
    { id: 'herakles', url: 'herakles.html' },
    { id: 'aint', url: 'aint.html' }
];

// Load all images in parallel
document.addEventListener('DOMContentLoaded', () => {
    // Create an array of promises for all image loads
    const loadPromises = pedals.map(pedal =>
        loadBase64Background(pedal.url, pedal.id)
    );

    // Wait for all images to load (optional)
    Promise.all(loadPromises).then(() => {
        console.log('All images loaded');
    });
});
</script>

<div class="favorites-container">
  <div class="favorites-header">
    <h1>My Favorites</h1>
    <div class="header-buttons">
      <button class="export-all-button">Export All Favorites</button>
      <button class="back-button">Back to Pedals</button>
    </div>
  </div>
  <div class="favorites-grid">
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', () => {
  const knobs = document.querySelectorAll('.knob-container');
  knobs.forEach(knobContainer => {
    const knob = knobContainer.querySelector('.knob');
    let dragging = false;
    let startX, startY;
    let originalX, originalY;
    let startAngle, currentAngle;
    function calculateAngle(x, y, centerX, centerY) {
      return Math.atan2(y - centerY, x - centerX) * 180 / Math.PI;
    }
    function rotateKnob(e) {
      const rect = knobContainer.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const mouseX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
      const mouseY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
      currentAngle = calculateAngle(mouseX, mouseY, centerX, centerY);
      let delta = currentAngle - startAngle;
      if (delta > 180) delta -= 360;
      if (delta < -180) delta += 360;
      let newRotation = parseInt(knob.dataset.rotation || 0) + delta;
      newRotation = Math.min(150, Math.max(-150, newRotation));
      knob.style.transform = `rotate(${newRotation}deg)`;
      knob.dataset.rotation = newRotation;
      startAngle = currentAngle;
    }
    knobContainer.addEventListener('mousedown', e => {
      if (e.shiftKey) {
        dragging = true;
        startX = e.clientX;
        startY = e.clientY;
        const rect = knobContainer.getBoundingClientRect();
        originalX = rect.left;
        originalY = rect.top;
      } else {
        const rect = knobContainer.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        startAngle = calculateAngle(e.clientX, e.clientY, centerX, centerY);
        knob.dataset.dragging = true;
      }
    });
    knobContainer.addEventListener('touchstart', e => {
      e.preventDefault();
      const rect = knobContainer.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      startAngle = calculateAngle(e.touches[0].clientX, e.touches[0].clientY, centerX, centerY);
      knob.dataset.dragging = true;
      if (e.touches.length > 1) {
        dragging = true;
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        const rect = knobContainer.getBoundingClientRect();
        originalX = rect.left;
        originalY = rect.top;
      }
    });
    document.addEventListener('mousemove', e => {
      if (dragging) {
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        const pedal = knobContainer.closest('.pedal-image');
        const pedalRect = pedal.getBoundingClientRect();
        const newLeft = (originalX + dx - pedalRect.left) / pedalRect.width * 100;
        const newTop = (originalY + dy - pedalRect.top) / pedalRect.height * 100;
        knobContainer.style.left = `${newLeft}%`;
        knobContainer.style.top = `${newTop}%`;
      } else if (knob.dataset.dragging === 'true') {
        rotateKnob(e);
      }
    });
    document.addEventListener('touchmove', e => {
      if (knob.dataset.dragging === 'true') {
        e.preventDefault();
        rotateKnob(e);
      }
    });
    document.addEventListener('mouseup', () => {
      dragging = false;
      knob.dataset.dragging = false;
    });
    document.addEventListener('touchend', () => {
      dragging = false;
      knob.dataset.dragging = false;
    });
  });

  const allRadioButtons = document.querySelectorAll('.radio-button');
  const allLedContainers = document.querySelectorAll('.led-container:not(.second-led-set)');
  allLedContainers.forEach(ledContainer => {
    const leds = ledContainer.querySelectorAll('.led');
    const isEnigmaxLeft = ledContainer.closest('.pedal')?.querySelector('h2')?.textContent === 'Enigmax' && !ledContainer.classList.contains('second-led-set');
    if (!isEnigmaxLeft) {
      leds[0].classList.add('red');
    } else {
      leds[0].classList.add('red');
    }
  });

  allRadioButtons.forEach(radioButton => {
    const ledContainer = radioButton.closest('.led-container');
    const leds = ledContainer.querySelectorAll('.led');
    ledContainer.dataset.currentState = '0'; // Initialize state tracking

    let currentState = 1;
    const isEnigmaxLeft = ledContainer.closest('.pedal')?.querySelector('h2')?.textContent === 'Enigmax' && !ledContainer.classList.contains('second-led-set');
    const totalStates = ledContainer.classList.contains('second-led-set') ? 3 : isEnigmaxLeft ? 10 : 7;

    if (ledContainer.classList.contains('second-led-set')) {
      leds.forEach(led => {
        led.className = 'led led-cyan'; // Add specific class for second set
        led.style.background = 'black';
        led.style.boxShadow = 'none';
      });
      leds[0].style.background = 'radial-gradient(circle at center, #00ffff 0%, #00cccc 40%, #009999 100%)';
      leds[0].style.boxShadow = '0 0 5px 2px rgba(0, 255, 255, 0.7)';
    }

    radioButton.addEventListener('click', () => {
      ledContainer.dataset.currentState = currentState.toString();

      if (ledContainer.classList.contains('second-led-set')) {
        leds.forEach(led => {
          led.className = 'led led-cyan';
          led.style.background = 'black';
          led.style.boxShadow = 'none';
        });
        const activeLed = leds[currentState];
        activeLed.style.background = 'radial-gradient(circle at center, #00ffff 0%, #00cccc 40%, #009999 100%)';
        activeLed.style.boxShadow = '0 0 5px 2px rgba(0, 255, 255, 0.7)';
      } else if (isEnigmaxLeft) {
        leds.forEach(led => {
          led.className = 'led';
        });
        if (currentState < 3) {
          leds[currentState].classList.add('red');
        } else if (currentState < 6) {
          leds[currentState - 3].classList.add('green');
        } else if (currentState < 9) {
          leds[currentState - 6].classList.add('amber');
        }
      } else {
        leds.forEach(led => {
          led.className = 'led';
        });
        switch (currentState) {
          case 0: leds[0].classList.add('red'); break;
          case 1: leds[1].classList.add('red'); break;
          case 2: leds[2].classList.add('red'); break;
          case 3: leds[0].classList.add('green'); break;
          case 4: leds[1].classList.add('green'); break;
          case 5: leds[2].classList.add('green'); break;
          case 6: break;
        }
      }
      currentState = (currentState + 1) % totalStates;
    });
  });

  function getPedalExtension(pedalName) {
    const extensionMap = {
      'Cream \'65': 'cream',
      'Rigby \'63': 'rigby',
      'Leo \'68': 'leo',
      'Willow \'55': 'willow',
      'Enigmax': 'enigmax',
      'Herakles': 'herakles',
      'Aint': 'aint'
    };
    return extensionMap[pedalName];
  }

  function validatePedalFile(pedalName, fileName) {
    const expectedExt = getPedalExtension(pedalName);
    return fileName.toLowerCase().endsWith(`.${expectedExt}`);
  }

  document.querySelectorAll('.save-button').forEach(button => {
    button.addEventListener('click', async function () {
      const pedal = button.closest('.pedal');
      const pedalName = pedal.querySelector('h2').textContent.trim();
      const pedalExtension = getPedalExtension(pedalName);
      const pedalImage = pedal.querySelector('.pedal-image');
      try {
        const canvas = await html2canvas(pedalImage, {
          backgroundColor: '#1a1a1a',
          scale: 2,
          logging: false
        });

        const settings = saveSettings(pedal);

        canvas.toBlob(async function (mainImageBlob) {
          try {
            const zip = new JSZip();
            zip.file('settings.json', JSON.stringify(settings));
            zip.file('preview.png', mainImageBlob);

            // === Capture UAFX controls preview ===
            const mainControls = pedal.querySelector('.main-pedal-controls');
            const uafxControls = pedal.querySelector('.uafx-controls-interface');

            // Temporarily switch to UAFX controls
            mainControls.style.display = 'none';
            uafxControls.style.display = 'block';

            // Give layout time to settle (just in case)
            await new Promise(resolve => setTimeout(resolve, 100));

            /* const uafxImageBlob = await domtoimage.toBlob(uafxControls); */

            // Save current styles
            const originalHeight = uafxControls.style.height;
            const originalMaxHeight = uafxControls.style.maxHeight;
            const originalOverflow = uafxControls.style.overflow;

            // Force full expansion for capture
            uafxControls.style.height = 'auto';
            uafxControls.style.maxHeight = 'none';
            uafxControls.style.overflow = 'visible';

            const uafxImageBlob = await domtoimage.toBlob(uafxControls);

            // Restore original styles
            uafxControls.style.height = originalHeight;
            uafxControls.style.maxHeight = originalMaxHeight;
            uafxControls.style.overflow = originalOverflow;


            // Add UAFX preview to zip
            zip.file('previewUafxControls.png', uafxImageBlob);

            // Restore original view
            mainControls.style.display = 'block';
            uafxControls.style.display = 'none';

            const zipContent = await zip.generateAsync({ type: 'blob' });
            const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
            const fileName = `UAudio-${settings.pedalName}-${timestamp}.${pedalExtension}`.replace(/\s+/g, '-');

            const link = document.createElement('a');
            link.download = fileName;
            link.href = URL.createObjectURL(zipContent);
            link.click();
            URL.revokeObjectURL(link.href);
          } catch (error) {
            console.error('Error saving UAFX preview:', error);
            alert('Sorry, there was an error saving the settings. Please try again.');
          }
        }, 'image/png', 1.0);
      } catch (error) {
        console.error('Error generating save file:', error);
        alert('Sorry, there was an error saving the settings. Please try again.');
      }
    });
  });

  document.querySelectorAll('.import-button').forEach(button => {
    const fileInput = button.closest('.button-group').querySelector('.import-input');
    button.addEventListener('click', () => {
      fileInput.click();
    });
    fileInput.addEventListener('change', async e => {
      const file = e.target.files[0];
      if (!file) return;
      try {
        const zip = await JSZip.loadAsync(file);
        const settingsJson = await zip.file('settings.json').async('text');
        const settings = JSON.parse(settingsJson);
        const pedal = Array.from(document.querySelectorAll('.pedal')).find(p => p.querySelector('h2').textContent.trim() === settings.pedalName);
        if (!pedal) {
          throw new Error('No matching pedal found');
        }
        if (!validatePedalFile(settings.pedalName, file.name)) {
          alert(`Invalid file format. This pedal only accepts .${getPedalExtension(settings.pedalName)} files.`);
          return;
        }
        const presetName = file.name.split('.')[0];
        pedal.querySelector('.preset-name').textContent = presetName;
        restoreSettings(pedal, settings);
        pedal.scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });
      } catch (error) {
        console.error('Error importing settings:', error);
        alert('Error importing settings. Please make sure this is a valid settings file.');
      }
      fileInput.value = '';
    });
  });

  const favoritesContainer = document.querySelector('.favorites-container');
  const pedalContainer = document.querySelector('.pedal-container');
  const favoritesGrid = document.querySelector('.favorites-grid');
  const pedalFavorites = JSON.parse(localStorage.getItem('pedal-favorites')) || {};

  document.querySelectorAll('.add-favorite-button').forEach(button => {
    button.addEventListener('click', async function () {
      const pedal = button.closest('.pedal');
      const pedalImage = pedal.querySelector('.pedal-image');
      const pedalName = pedal.querySelector('h2').textContent.trim();
      if (!pedalFavorites[pedalName]) {
        pedalFavorites[pedalName] = [];
      }
      const customName = prompt('Enter a name for this favorite:', '');
      if (customName === null) return;
      try {
        const canvas = await html2canvas(pedalImage, {
          backgroundColor: '#1a1a1a',
          scale: 2,
          logging: false
        });
        const imageData = canvas.toDataURL('image/jpeg', 1.0);
        const timestamp = new Date().toLocaleString();
        pedalFavorites[pedalName].push({
          name: pedalName,
          customName: customName,
          image: imageData,
          timestamp: timestamp,
          settings: saveSettings(pedal)
        });
        localStorage.setItem('pedal-favorites', JSON.stringify(pedalFavorites));
        alert('Added to favorites!');
      } catch (error) {
        console.error('Error saving favorite:', error);
        alert('Sorry, there was an error saving to favorites. Please try again.');
      }
    });
  });

  document.querySelectorAll('[data-control-type="input"] button').forEach(button => {
    button.addEventListener('click', () => {
      const slider = button.closest('.uafx-control-group').querySelector('.fet-trim-slider');

      // Remove active class from both buttons
      button.parentElement.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));

      // Set clicked button as active
      button.classList.add('active');

      // Show or hide slider depending on button value
      if (button.getAttribute('data-value') === 'fet') {
        slider.style.display = 'block';
      } else {
        slider.style.display = 'none';
      }
    });
  });


  document.querySelectorAll('.show-favorites-button').forEach(button => {
    button.addEventListener('click', () => {
      const pedal = button.closest('.pedal');
      const pedalName = pedal.querySelector('h2').textContent.trim();
      pedalContainer.style.display = 'none';
      favoritesContainer.style.display = 'block';
      const favoritesHeader = document.querySelector('.favorites-header h1');
      favoritesHeader.textContent = `${pedalName} Favorites`;
      favoritesGrid.innerHTML = '';
      const pedalFavoritesList = pedalFavorites[pedalName] || [];
      pedalFavoritesList.forEach((favorite, index) => {
        const favoriteItem = document.createElement('div');
        favoriteItem.className = 'favorite-item';
        favoriteItem.innerHTML = `
          <img src="${favorite.image}" alt="${favorite.name}">
          <h3 class="favorite-title">${favorite.customName || favorite.name}</h3>
          <p class="favorite-timestamp">${favorite.timestamp}</p>
          <button class="delete-favorite" data-index="${index}"></button>
        `;
        favoritesGrid.appendChild(favoriteItem);
        favoriteItem.addEventListener('dblclick', () => {
          const favorite = pedalFavorites[pedalName][index];
          favoritesContainer.style.display = 'none';
          pedalContainer.style.display = 'flex';
          const targetPedal = Array.from(document.querySelectorAll('.pedal')).find(p => p.querySelector('h2').textContent.trim() === pedalName);
          if (targetPedal) {
            targetPedal.querySelector('.preset-name').textContent = favorite.customName || favorite.name;
            restoreSettings(targetPedal, favorite.settings);
            targetPedal.scrollIntoView({
              behavior: 'smooth',
              block: 'center'
            });
          }
        });
      });
      document.querySelectorAll('.delete-favorite').forEach(deleteButton => {
        deleteButton.addEventListener('click', e => {
          const index = parseInt(e.target.dataset.index);
          if (confirm('Are you sure you want to delete this favorite?')) {
            pedalFavorites[pedalName].splice(index, 1);
            localStorage.setItem('pedal-favorites', JSON.stringify(pedalFavorites));
            button.click();
          }
        });
      });
    });
  });

  document.querySelector('.back-button').addEventListener('click', () => {
    favoritesContainer.style.display = 'none';
    pedalContainer.style.display = 'flex';
  });

  document.querySelector('.export-all-button').addEventListener('click', async function () {
    const currentPedalName = document.querySelector('.favorites-header h1').textContent.replace(' Favorites', '').trim();
    const currentFavorites = pedalFavorites[currentPedalName] || [];
    if (currentFavorites.length === 0) {
      alert('No favorites to export!');
      return;
    }
    for (const favorite of currentFavorites) {
      try {
        const zip = new JSZip();
        const imageData = favorite.image.split(',')[1];
        const imageBlob = await fetch(`data:image/jpeg;base64,${imageData}`).then(r => r.blob());
        zip.file('settings.json', JSON.stringify({
          pedalName: favorite.name,
          knobPositions: favorite.settings.knobPositions,
          ledStates: favorite.settings.ledStates
        }));
        zip.file('preview.png', imageBlob);
        const extension = getPedalExtension(favorite.name);
        const zipContent = await zip.generateAsync({
          type: 'blob',
          mimeType: `application/x-${extension}`
        });
        const link = document.createElement('a');
        const safeCustomName = (favorite.customName || `${favorite.name}-${favorite.timestamp}`).replace(/[^a-z0-9-]/gi, '_');
        const fileName = `UAudio-${safeCustomName}.${extension}`;
        link.download = fileName;
        link.href = URL.createObjectURL(zipContent);
        link.click();
        URL.revokeObjectURL(link.href);
        await new Promise(resolve => setTimeout(resolve, 500));
      } catch (error) {
        console.error('Error exporting favorite:', error);
        alert(`Error exporting favorite "${favorite.customName}". Please try again.`);
      }
    }
    alert('Export complete!');
  });

  function saveSettings(pedal) {
    const uafxControls = {};
    const uafxInterface = pedal.querySelector('.uafx-controls-interface');

    // Save UAFX button group states (e.g., Input Routing)
    uafxInterface.querySelectorAll('.uafx-button-group, .uafx-button-group-vert').forEach(group => {
        const controlType = group.dataset.controlType;
        const activeButton = group.querySelector('button.active');
        if (controlType && activeButton) {
            uafxControls[controlType] = activeButton.dataset.value;
        }
    });

    // Save checkbox states (e.g., Ghost Notes, Bright Cap)
    uafxInterface.querySelectorAll('input[type="checkbox"]').forEach(checkbox => {
        if (checkbox.classList.contains('ghost-notes-toggle')) {
            uafxControls['ghost-notes'] = checkbox.checked;
        } else if (checkbox.classList.contains('bright-cap-toggle')) {
            uafxControls['bright-cap'] = checkbox.checked;
        }
    });

    // Save UAFX toggle button states (e.g., Mods, Noise Gate Enable)
    uafxInterface.querySelectorAll('.uafx-toggle-button').forEach(button => {
        const controlType = button.dataset.controlType;
        if (controlType) {
            uafxControls[controlType] = button.classList.contains('active');
        }
    });

    // Save UAFX slider values (e.g., Noise Gate params)
    uafxInterface.querySelectorAll('input[type="range"]').forEach(slider => {
        const controlType = slider.dataset.controlType;
        if (controlType) {
            uafxControls[controlType] = slider.value;
        }
    });

    return {
      pedalName: pedal.querySelector('h2').textContent.trim(),
      knobPositions: Array.from(pedal.querySelectorAll('.knob')).map(knob => ({
        param: knob.dataset.param,
        rotation: knob.dataset.rotation || '0',
        top: knob.closest('.knob-container').style.top,
        left: knob.closest('.knob-container').style.left
      })),
      ledStates: {
        firstSet: Array.from(pedal.querySelectorAll('.led-container:not(.second-led-set) .led')).map(led => ({
          className: led.className,
          currentState: led.closest('.led-container').dataset.currentState || '0'
        })),
        secondSet: Array.from(pedal.querySelectorAll('.led-container.second-led-set .led')).map(led => ({
          className: led.className,
          currentState: led.closest('.led-container').dataset.currentState || '0',
          style: {
            background: led.style.background,
            boxShadow: led.style.boxShadow
          }
        }))
      },
      uafxControls: uafxControls // Add UAFX controls state
    };
  }

  function restoreSettings(pedal, settings) {
    // Restore knob positions first
    if (settings.knobPositions) {
      settings.knobPositions.forEach(knobSetting => {
        const knob = pedal.querySelector(`[data-param="${knobSetting.param}"]`);
        if (knob) {
          knob.dataset.rotation = knobSetting.rotation;
          knob.style.transform = `rotate(${knobSetting.rotation}deg)`;
          const knobContainer = knob.closest('.knob-container');
          knobContainer.style.top = knobSetting.top;
          knobContainer.style.left = knobSetting.left;
        }
      });
    }

    // Restore LED states
    if (settings.ledStates) {
      // Restore first LED set
      const firstSetLeds = pedal.querySelectorAll('.led-container:not(.second-led-set) .led');
      if (settings.ledStates.firstSet) {
          settings.ledStates.firstSet.forEach((ledState, idx) => {
              if (firstSetLeds[idx]) {
                  firstSetLeds[idx].className = ledState.className;
                  const container = firstSetLeds[idx].closest('.led-container');
                  if (container) container.dataset.currentState = ledState.currentState;
              }
          });
      }

      // Restore second LED set
      const secondSetLeds = pedal.querySelectorAll('.led-container.second-led-set .led');
      if (settings.ledStates.secondSet) {
          settings.ledStates.secondSet.forEach((ledState, idx) => {
              if (secondSetLeds[idx]) {
                  secondSetLeds[idx].className = ledState.className;
                  secondSetLeds[idx].style.background = ledState.style.background || '';
                  secondSetLeds[idx].style.boxShadow = ledState.style.boxShadow || '';
                  const container = secondSetLeds[idx].closest('.led-container');
                  if (container) container.dataset.currentState = ledState.currentState;
              }
          });
      }
    }

    // Restore UAFX Controls
    if (settings.uafxControls) {
      const uafxInterface = pedal.querySelector('.uafx-controls-interface');
      Object.entries(settings.uafxControls).forEach(([controlType, value]) => {
        // Restore button groups
        const buttonGroup = uafxInterface.querySelector(`.uafx-button-group[data-control-type="${controlType}"]`);
        if (buttonGroup) {
          buttonGroup.querySelectorAll('button').forEach(button => {
            button.classList.toggle('active', button.dataset.value === value);
          });
        }

        // Restore toggle buttons
        const toggleButton = uafxInterface.querySelector(`.uafx-toggle-button[data-control-type="${controlType}"]`);
        if (toggleButton) {
          toggleButton.classList.toggle('active', value);
          toggleButton.textContent = value ? 'ON' : 'OFF';
           // Special handling for noise gate visibility
           if (controlType === 'noise-gate-enable') {
                const sliderGroup = pedal.querySelector('.noise-gate-sliders');
                if (sliderGroup) {
                    sliderGroup.style.display = value ? 'flex' : 'none';
                }
            }
            if (controlType === 'hrm-eq-enable') {
                 const sliderGroup = pedal.querySelector('.hrm-eq-sliders');
                 if (sliderGroup) {
                     sliderGroup.style.display = value ? 'flex' : 'none';
                 }
             }
        }

        // Restore checkbox states (e.g., Ghost Notes, Bright Cap)
        const ghostCheckbox = uafxInterface.querySelector('.ghost-notes-toggle');
        if (ghostCheckbox && 'ghost-notes' in settings.uafxControls) {
          ghostCheckbox.checked = settings.uafxControls['ghost-notes'];
        }

        const brightCapCheckbox = uafxInterface.querySelector('.bright-cap-toggle');
        if (brightCapCheckbox && 'bright-cap' in settings.uafxControls) {
          brightCapCheckbox.checked = settings.uafxControls['bright-cap'];
        }

        // Restore sliders
        const slider = uafxInterface.querySelector(`input[type="range"][data-control-type="${controlType}"]`);
        if (slider) {
          slider.value = value;
        }
      });
    }
  }

   // Function to initialize UAFX controls for a specific pedal
   function initializeUafxControls(pedalElement) {
    const uafxInterface = pedalElement.querySelector('.uafx-controls-interface');
    if (!uafxInterface) return; // No UAFX controls for this pedal

    // --- Button Group Handling (e.g., Input Routing) ---
    uafxInterface.querySelectorAll('.uafx-button-group, .uafx-button-group-vert').forEach(group => {
        group.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                // Deactivate all buttons in the group
                group.querySelectorAll('button').forEach(btn => btn.classList.remove('active'));
                // Activate the clicked button
                e.target.classList.add('active');
            }
        });
    });

    // --- Toggle Button Handling (e.g., Mods, Noise Gate Enable) ---
    uafxInterface.querySelectorAll('.uafx-toggle-button').forEach(button => {
        button.addEventListener('click', () => {
            const isActive = button.classList.toggle('active');
            button.textContent = isActive ? 'ON' : 'OFF';

            // Special handling for Noise Gate enable/disable
            if (button.dataset.controlType === 'noise-gate-enable') {
                const sliderGroup = pedalElement.querySelector('.noise-gate-sliders');
                if (sliderGroup) {
                    sliderGroup.style.display = isActive ? 'flex' : 'none';
                }
            }
            if (button.dataset.controlType === 'hrm-eq-enable') {
                const sliderGroup = pedalElement.querySelector('.hrm-eq-sliders');
                if (sliderGroup) {
                    sliderGroup.style.display = isActive ? 'flex' : 'none';
                }
            }
        });
         // Initialize text content based on initial state (if not already set by restoreSettings)
        if (!button.textContent) {
             button.textContent = button.classList.contains('active') ? 'ON' : 'OFF';
        }
    });

    // --- Slider Handling (already functional, just ensure they exist) ---
    uafxInterface.querySelectorAll('input[type="range"]').forEach(slider => {
        // Add any specific slider logic here if needed in the future
    });
   }

  // Initialize UAFX controls for all pedals on page load
  document.querySelectorAll('.pedal').forEach(initializeUafxControls);

});

document.addEventListener('DOMContentLoaded', () => {
  // Add event listeners for UAFX controls buttons
  document.querySelectorAll('.uafx-controls-button').forEach(button => {
    button.addEventListener('click', function() {
      const pedal = button.closest('.pedal');
      const mainControls = pedal.querySelector('.main-pedal-controls');
      const uafxControls = pedal.querySelector('.uafx-controls-interface');

      const saveBtn = pedal.querySelector('.save-button');
      const importBtn = pedal.querySelector('.import-button');
      const addFavBtn = pedal.querySelector('.add-favorite-button');
      const showFavBtn = pedal.querySelector('.show-favorites-button');

      const toggleButtons = [saveBtn, importBtn, addFavBtn, showFavBtn];

      if (mainControls.style.display !== 'none') {
        // Show UAFX controls
        mainControls.style.display = 'none';
        uafxControls.style.display = 'block';
        button.textContent = 'go back to pedal controls';

        // Hide and disable buttons
        toggleButtons.forEach(btn => {
          btn.style.display = 'none';
          btn.disabled = true;
        });

      } else {
        // Show pedal controls
        mainControls.style.display = 'block';
        uafxControls.style.display = 'none';
        button.textContent = 'uafx controls';

        // Show and enable buttons
        toggleButtons.forEach(btn => {
          btn.style.display = 'block';
          btn.disabled = false;
        });
      }
    });
  });  
});

function updateSliderBackground(slider) {
      const value = (slider.value - slider.min) / (slider.max - slider.min) * 100;
      slider.style.background = `linear-gradient(to right, #00ccff ${value}%, #555 ${value}%)`;
    }

    document.querySelectorAll('input[type="range"]').forEach(slider => {
      updateSliderBackground(slider); // Initial fill
      slider.addEventListener('input', () => updateSliderBackground(slider));
    });

document.addEventListener('DOMContentLoaded', () => {
  const channelButtons = document.querySelectorAll('[data-control-type="channel-select"] button');
  const channelStyleButtonsOrange = document.querySelectorAll('[data-control-type="channel-style"] button');
  const channelStyleButtonsRed = document.querySelectorAll('[data-control-type="channel-style-red"] button');
  const channelStyleOptionsOrange = document.querySelector('.channel-style-options');
  const channelStyleOptionsRed = document.querySelector('.channel-style-options-red');

  // Handle top-level channel selection
  channelButtons.forEach(button => {
    button.addEventListener('click', () => {
      const value = button.dataset.value;

      // Remove active from all
      channelButtons.forEach(btn => btn.classList.remove('active'));
      button.classList.add('active');

      // Toggle orange/red sub-options
      if (value === 'orange-channel') {
        channelStyleOptionsOrange.style.display = 'block';
        channelStyleOptionsRed.style.display = 'none';
      } else if (value === 'red-channel') {
        channelStyleOptionsOrange.style.display = 'none';
        channelStyleOptionsRed.style.display = 'block';
      } else {
        channelStyleOptionsOrange.style.display = 'none';
        channelStyleOptionsRed.style.display = 'none';

        // Clear both sub-option selections
        channelStyleButtonsOrange.forEach(b => b.classList.remove('active'));
        channelStyleButtonsRed.forEach(b => b.classList.remove('active'));
      }
    });
  });

  // Orange sub-options
  channelStyleButtonsOrange.forEach(button => {
    button.addEventListener('click', () => {
      channelStyleButtonsOrange.forEach(b => b.classList.remove('active'));
      button.classList.add('active');

      // Keep orange-channel active
      channelButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.value === 'orange-channel');
      });

      channelStyleOptionsOrange.style.display = 'block';
      channelStyleOptionsRed.style.display = 'none';
    });
  });

  // Red sub-options
  channelStyleButtonsRed.forEach(button => {
    button.addEventListener('click', () => {
      channelStyleButtonsRed.forEach(b => b.classList.remove('active'));
      button.classList.add('active');

      // Keep red-channel active
      channelButtons.forEach(btn => {
        btn.classList.toggle('active', btn.dataset.value === 'red-channel');
      });

      channelStyleOptionsRed.style.display = 'block';
      channelStyleOptionsOrange.style.display = 'none';
    });
  });
});


</script>
</body>
</html>