<html><head><base href="."><title>UAudio Amp Library</title>
<meta name="description" content="UAudio pedal tone settings manager and library">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
<style>* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  background: #1a1a1a;
  color: #fff;
  font-family: Arial, sans-serif;
  padding: 20px;
}

.app-header {
  text-align: center;
  padding: 20px 0 40px;
  background: linear-gradient(to right, #1a1a1a, #2a2a2a);
  margin-bottom: 20px;
  border-bottom: 1px solid #333;
}

.app-header h1 {
  font-size: 2.5em;
  color: #fff;
  margin-bottom: 10px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.5);
}

.app-header .tagline {
  color: #999;
  font-size: 1.1em;
  font-style: italic;
}
#donate-button-container {
  margin: 20px auto 0;
  text-align: center;
  position: static;
}

.pedal-container {
  display: flex;
  flex-wrap: wrap;
  gap: 20px;
  justify-content: center;
  padding: 20px;
}

.pedal {
  background: #2a2a2a;
  border-radius: 10px;
  padding: 20px;
  width: 300px;
  position: relative;
}

.pedal-image {
  width: 100%;
  height: 400px;
  background-size: contain;
  background-repeat: no-repeat;
  background-position: center;
  position: relative;
}

.knob-container {
  position: absolute;
  width: 40px;
  height: 40px;
  cursor: move;
  z-index: 100;
}

.knob {
  width: 100%;
  height: 100%;
  border-radius: 50%;
  background: #444;
  position: relative;
  cursor: pointer;
  transform-origin: center center;
  transition: transform 0.1s;
  user-select: none;
  -webkit-user-select: none;
  touch-action: none;
}

.knob::after {
  content: '';
  position: absolute;
  width: 2px;
  height: 50%;
  background: #fff;
  left: 50%;
  transform: translateX(-50%);
}

.pedal h2 {
  text-align: center;
  margin-bottom: 10px;
  color: #ddd;
}

.controls {
  margin-top: 10px;
  text-align: center;
}

.value-display {
  display: none;
}

/* Button styles */
.button-group {
  display: flex;
  flex-direction: column;
  gap: 10px;  /* Reduced from previous value */
  margin-top: 15px;
}

.save-button, 
.import-button,
.add-favorite-button,
.show-favorites-button {
  display: block;
  width: 100%;
  margin: 0 auto;  /* Reset any individual margins */
  padding: 10px 20px;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
  transition: background 0.3s;
}

.save-button:hover, 
.import-button:hover,
.add-favorite-button:hover,
.show-favorites-button:hover {
  background: #666;
}

/* LED styles */
.led-container {
  position: absolute;
  top: 28.65%;
  left: 9.5%;
  display: flex;
  flex-direction: column;
  gap: 5px;
  align-items: center;
}
  
.led-container.second-led-set {
  position: absolute;
  top: 28.65%;
  left: 87%;
  display: flex;
  flex-direction: column;
  gap: 5px;
  align-items: center;
}

.led-container.second-led-set .radio-button {
  position: absolute;  /* Remove absolute positioning */
  transform: 5;   /* Remove transform */
  order: -1;        /* Place radio button first in the flex container */
  margin-right: 43px; /* Add some spacing after the radio button */
}

.led-container.second-led-set .led {
  margin-left: 0;  /* Remove default left margin */
}

.led {
  width: 8.71px;
  height: 8.71px;
  border-radius: 50%;
  background-color: black;
  transition: background-color 0.3s ease, box-shadow 0.3s ease;
}

.led.red {
  background: radial-gradient(circle at center, 
    #ffeb3b 0%, 
    #ff5722 40%, 
    #f44336 100%);
  box-shadow: 0 0 5px 2px rgba(255, 0, 0, 0.7);
}

.led.green {
  background: radial-gradient(circle at center, 
    #b2ff59 0%, 
    #4caf50 40%, 
    #2e7d32 100%);
  box-shadow: 0 0 5px 2px rgba(0, 255, 0, 0.7);
}

.led.amber {
  background: radial-gradient(circle at center, 
    #ffca28 0%, 
    #ffa000 40%, 
    #ff6f00 100%);
  box-shadow: 0 0 5px 2px rgba(255, 165, 0, 0.7);
}

.radio-button {
  position: absolute;
  top: 50%;
  transform: translateY(-51%);
  margin-left: 43px;
}

.led-container.second-led-set .radio-button {
  margin-left: 0;
}

.save-button {
  margin: 0;
}

/* Favorites page styles */
.favorites-container {
  padding: 20px;
  display: none;
}

.favorites-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 20px;
}

.header-buttons {
  display: flex;
  gap: 10px;
}

.export-all-button {
  padding: 10px 20px;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
}

.export-all-button:hover {
  background: #666;
}

.back-button {
  padding: 10px 20px;
  background: #444;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 14px;
}

.back-button:hover {
  background: #666;
}

.favorites-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
  gap: 20px;
}

.favorite-item {
  background: #2a2a2a;
  border-radius: 10px;
  padding: 15px;
  position: relative; 
  cursor: pointer;
  transition: transform 0.2s;
}

.favorite-item:hover {
  transform: scale(1.02);
}

/* Add tooltip hint */
.favorite-item::after {
  content: 'Double-click to restore settings';
  position: absolute;
  bottom: -30px;
  left: 50%;
  transform: translateX(-50%);
  background: rgba(0, 0, 0, 0.8);
  padding: 5px 10px;
  border-radius: 4px;
  font-size: 12px;
  opacity: 0;
  transition: opacity 0.2s;
  pointer-events: none;
}

.favorite-item:hover::after {
  opacity: 1;
}

.favorite-item img {
  width: 100%;
  height: auto;
  border-radius: 5px;
}

.favorite-title {
  margin: 10px 0;
  color: #fff;
  text-align: center;
}

/* Add styles for the pedal name display */
.favorite-pedal-name {
  color: #888;
  font-size: 0.9em;
  text-align: center;
  margin-top: 5px;
}

.delete-favorite {
  position: absolute;
  top: 10px;
  right: 10px;
  background: #ff4444;
  color: white;
  border: none;
  border-radius: 50%;
  width: 24px;
  height: 24px;
  cursor: pointer;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: bold;
  transition: opacity 0.3s, background-color 0.3s;
  opacity: 0;
}

.favorite-item:hover .delete-favorite {
  opacity: 1;
}

.delete-favorite:hover {
  background: #ff0000;
}

/* Add styles for preset name display */
.preset-name {
  text-align: center;
  color: #888;
  margin-top: 10px;
  margin-bottom: 10px;
  font-style: italic;
}

/* Add to existing CSS */
.knob-container.secondary {
  transform: scale(1.5);
  opacity: 0.6;
  z-index: 90;
}
</style></head>
<body>
<header class="app-header">
  <h1>UAudio Amp Library</h1>
  <p class="tagline">Your Ultimate Tone Library Manager</p>
  <div id="donate-button-container">
      <div style="margin-top: 50px;"></div>
      <div id="donate-button"></div>
      <script src="https://www.paypalobjects.com/donate/sdk/donate-sdk.js" charset="UTF-8"></script>
      <script>
          PayPal.Donation.Button({
              env: 'production',
              hosted_button_id: 'KTN5H79BND7MQ',
              image: {
                  src: 'https://www.paypalobjects.com/en_US/GB/i/btn/btn_donateCC_LG.gif',
                  alt: 'Donate with PayPal button',
                  title: 'PayPal - The safer, easier way to pay online!'
              }
          }).render('#donate-button');
      </script>
    </div>
</header>
<div class="pedal-container">
  <!-- Cream '65 -->
  <div class="pedal">
    <h2>Cream &apos;65</h2>
    <div class="pedal-image" id="cream" style="background-image: none;">
      <div class="knob-container" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="bass"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 73.33%">
        <div class="knob" data-param="treble"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="reverb"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="mid"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="master"></div>
      </div>
      <!-- Secondary Knobs -->
      <div class="knob-container secondary" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="mid-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="master-secondary"></div>
      </div>
      <div class="led-container">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control">
      </div>
      <div class="led-container second-led-set">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-2">
      </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".cream" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Rigby '63 -->
  <div class="pedal">
    <h2>Rigby &apos;63</h2>
    <div class="pedal-image" id="rigby" style="background-image: none;">
      <div class="knob-container" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="tone"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 73.33%">
        <div class="knob" data-param="bias"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="drive"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="presence"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="master"></div>
      </div>
      <!-- Secondary Knobs -->
      <div class="knob-container secondary" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="drive-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="presence-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="master-secondary"></div>
      </div>
      <div class="led-container">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-rigby">
      </div>
      <div class="led-container second-led-set">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-2-rigby">
      </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".rigby" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Leo '68 -->
  <div class="pedal">
    <h2>Leo &apos;68</h2>
    <div class="pedal-image" id="leo" style="background-image: none;">
      <div class="knob-container" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="drive"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 73.33%">
        <div class="knob" data-param="tone"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="presence"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="bass"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="master"></div>
      </div>
      <!-- Secondary Knobs -->
      <div class="knob-container secondary" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="presence-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="bass-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="master-secondary"></div>
      </div>
      <div class="led-container">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-leo">
      </div>
      <div class="led-container second-led-set">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-2-leo">
      </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".leo" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Willow '55 -->
  <div class="pedal">
    <h2>Willow &apos;55</h2>
    <div class="pedal-image" id="willow" style="background-image: none;">
      <div class="knob-container" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="tone"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 73.33%">
        <div class="knob" data-param="mic"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="bass"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="mid"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="treble"></div>
      </div>
      <div class="led-container">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-willow">
      </div>
      <div class="led-container second-led-set">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-2-willow">
      </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".willow" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Enigmax -->
  <div class="pedal">
    <h2>Enigmax</h2>
    <div class="pedal-image" id="enigmax" style="background-image: none;">
      <div class="knob-container" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="range"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 73.33%">
        <div class="knob" data-param="filter"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="mix"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="sensitivity"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="output"></div>
      </div>
      <!-- Secondary Knobs -->
      <div class="knob-container secondary" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="range-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="mix-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="sensitivity-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="output-secondary"></div>
      </div>
      <div class="led-container">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-enigmax">
      </div>
      <div class="led-container second-led-set">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-2-enigmax">
      </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".enigmax" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Herakles -->
  <div class="pedal">
    <h2>Herakles</h2>
    <div class="pedal-image" id="herakles" style="background-image: none;">
      <div class="knob-container" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="gain"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 73.33%">
        <div class="knob" data-param="tone"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="bass"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="mid"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="treble"></div>
      </div>
      <!-- Secondary Knobs -->
      <div class="knob-container secondary" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="gain-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="bass-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="mid-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="treble-secondary"></div>
      </div>
      <div class="led-container">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-herakles">
      </div>
      <div class="led-container second-led-set">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-2-herakles">
      </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".herakles" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>

  <!-- Aint -->
  <div class="pedal">
    <h2>Aint</h2>
    <div class="pedal-image" id="aint" style="background-image: none;">
      <div class="knob-container" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="tone"></div>
      </div>
      <div class="knob-container" style="top: 13%; left: 73.33%">
        <div class="knob" data-param="filter"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="mix"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="drive"></div>
      </div>
      <div class="knob-container" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="master"></div>
      </div>
      <!-- Secondary Knobs -->
      <div class="knob-container secondary" style="top: 13%; left: 11.67%">
        <div class="knob" data-param="volume-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 13%; left: 41.67%">
        <div class="knob" data-param="tone-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 11.67%">
        <div class="knob" data-param="mix-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 41.67%">
        <div class="knob" data-param="drive-secondary"></div>
      </div>
      <div class="knob-container secondary" style="top: 42%; left: 73.33%">
        <div class="knob" data-param="master-secondary"></div>
      </div>
      <div class="led-container">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-aint">
      </div>
      <div class="led-container second-led-set">
        <div class="led"></div>
        <div class="led"></div>
        <div class="led"></div>
        <input type="radio" class="radio-button" name="led-control-2-aint">
      </div>
    </div>
    <div class="preset-name">Default</div>
    <div class="button-group">
      <button class="save-button">Save Current Settings</button>
      <input type="file" class="import-input" accept=".aint" style="display: none;">
      <button class="import-button">Import Saved Settings</button>
      <button class="add-favorite-button">Add To Favorites</button>
      <button class="show-favorites-button">Show Favorites</button>
    </div>
  </div>
</div>

<script>
async function loadBase64Background(url, elementId, retryCount = 0) {
    try {
        const element = document.getElementById(elementId);
        if (!element) {
            console.error(`Element with ID "${elementId}" not found`);
            return;
        }

        const response = await fetch(url, {
            method: 'GET',
            headers: {
                'Cache-Control': 'no-cache',
                'Pragma': 'no-cache'
            }
        });
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const base64Data = await response.text();
        
        // Check if we got actual data
        if (!base64Data || base64Data.length < 100) {
            if (retryCount < 3) {
                await new Promise(resolve => setTimeout(resolve, 500));
                return loadBase64Background(url, elementId, retryCount + 1);
            }
            return;
        }

        element.style.backgroundImage = `url(${base64Data})`;
    } catch (error) {
        console.error(`Failed to load image for ${elementId}:`, error);
    }
}

// Array of pedal configurations
const pedals = [
    { id: 'cream', url: 'cream.html' },
    { id: 'rigby', url: 'rigby.html' },
    { id: 'leo', url: 'leo.html' },
    { id: 'willow', url: 'willow.html' },
    { id: 'enigmax', url: 'enigmax.html' },
    { id: 'herakles', url: 'herakles.html' },
    { id: 'aint', url: 'aint.html' }
];

// Load all images in parallel
document.addEventListener('DOMContentLoaded', () => {
    // Create an array of promises for all image loads
    const loadPromises = pedals.map(pedal => 
        loadBase64Background(pedal.url, pedal.id)
    );
    
    // Wait for all images to load (optional)
    Promise.all(loadPromises).then(() => {
        console.log('All images loaded');
    });
});
</script>


<div class="favorites-container">
  <div class="favorites-header">
    <h1>My Favorites</h1>
    <div class="header-buttons">
      <button class="export-all-button">Export All Favorites</button>
      <button class="back-button">Back to Pedals</button>
    </div>
  </div>
  <div class="favorites-grid">
  </div>
</div>

<script>document.addEventListener('DOMContentLoaded', () => {
  const knobs = document.querySelectorAll('.knob-container');
  knobs.forEach(knobContainer => {
    const knob = knobContainer.querySelector('.knob');
    let dragging = false;
    let startX, startY;
    let originalX, originalY;
    let startAngle, currentAngle;
    function calculateAngle(x, y, centerX, centerY) {
      return Math.atan2(y - centerY, x - centerX) * 180 / Math.PI;
    }
    function rotateKnob(e) {
      const rect = knobContainer.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      const mouseX = e.type.includes('touch') ? e.touches[0].clientX : e.clientX;
      const mouseY = e.type.includes('touch') ? e.touches[0].clientY : e.clientY;
      currentAngle = calculateAngle(mouseX, mouseY, centerX, centerY);
      let delta = currentAngle - startAngle;
      if (delta > 180) delta -= 360;
      if (delta < -180) delta += 360;
      let newRotation = parseInt(knob.dataset.rotation || 0) + delta;
      newRotation = Math.min(150, Math.max(-150, newRotation));
      knob.style.transform = `rotate(${newRotation}deg)`;
      knob.dataset.rotation = newRotation;
      startAngle = currentAngle;
    }
    knobContainer.addEventListener('mousedown', e => {
      if (e.shiftKey) {
        dragging = true;
        startX = e.clientX;
        startY = e.clientY;
        const rect = knobContainer.getBoundingClientRect();
        originalX = rect.left;
        originalY = rect.top;
      } else {
        const rect = knobContainer.getBoundingClientRect();
        const centerX = rect.left + rect.width / 2;
        const centerY = rect.top + rect.height / 2;
        startAngle = calculateAngle(e.clientX, e.clientY, centerX, centerY);
        knob.dataset.dragging = true;
      }
    });
    knobContainer.addEventListener('touchstart', e => {
      e.preventDefault();
      const rect = knobContainer.getBoundingClientRect();
      const centerX = rect.left + rect.width / 2;
      const centerY = rect.top + rect.height / 2;
      startAngle = calculateAngle(e.touches[0].clientX, e.touches[0].clientY, centerX, centerY);
      knob.dataset.dragging = true;
      if (e.touches.length > 1) {
        dragging = true;
        startX = e.touches[0].clientX;
        startY = e.touches[0].clientY;
        originalX = rect.left;
        originalY = rect.top;
      }
    });
    document.addEventListener('mousemove', e => {
      if (dragging) {
        const dx = e.clientX - startX;
        const dy = e.clientY - startY;
        const pedal = knobContainer.closest('.pedal-image');
        const pedalRect = pedal.getBoundingClientRect();
        const newLeft = (originalX + dx - pedalRect.left) / pedalRect.width * 100;
        const newTop = (originalY + dy - pedalRect.top) / pedalRect.height * 100;
        knobContainer.style.left = `${newLeft}%`;
        knobContainer.style.top = `${newTop}%`;
      } else if (knob.dataset.dragging === 'true') {
        rotateKnob(e);
      }
    });
    document.addEventListener('touchmove', e => {
      if (knob.dataset.dragging === 'true') {
        e.preventDefault();
        rotateKnob(e);
      }
    });
    document.addEventListener('mouseup', () => {
      dragging = false;
      knob.dataset.dragging = false;
    });
    document.addEventListener('touchend', () => {
      dragging = false;
      knob.dataset.dragging = false;
    });
  });
  const allRadioButtons = document.querySelectorAll('.radio-button');
  const allLedContainers = document.querySelectorAll('.led-container:not(.second-led-set)');
  allLedContainers.forEach(ledContainer => {
    const leds = ledContainer.querySelectorAll('.led');
    const isEnigmaxLeft = ledContainer.closest('.pedal')?.querySelector('h2')?.textContent === 'Enigmax' && !ledContainer.classList.contains('second-led-set');
    if (!isEnigmaxLeft) {
      leds[0].classList.add('red');
    } else {
      leds[0].classList.add('red');
    }
  });
  allRadioButtons.forEach(radioButton => {
    const ledContainer = radioButton.closest('.led-container');
    const leds = ledContainer.querySelectorAll('.led');
    let currentState = 1;
    const isEnigmaxLeft = ledContainer.closest('.pedal')?.querySelector('h2')?.textContent === 'Enigmax' && !ledContainer.classList.contains('second-led-set');
    const totalStates = ledContainer.classList.contains('second-led-set') ? 3 : isEnigmaxLeft ? 10 : 7;
    if (ledContainer.classList.contains('second-led-set')) {
      leds.forEach(led => {
        led.style.background = 'black';
        led.style.boxShadow = 'none';
        led.className = 'led';
      });
      leds[0].style.background = 'radial-gradient(circle at center, #00ffff 0%, #00cccc 40%, #009999 100%)';
      leds[0].style.boxShadow = '0 0 5px 2px rgba(0, 255, 255, 0.7)';
    }
    radioButton.addEventListener('click', () => {
      if (ledContainer.classList.contains('second-led-set')) {
        leds.forEach(led => {
          led.style.background = 'black';
          led.style.boxShadow = 'none';
        });
        const activeLed = leds[currentState];
        activeLed.style.background = 'radial-gradient(circle at center, #00ffff 0%, #00cccc 40%, #009999 100%)';
        activeLed.style.boxShadow = '0 0 5px 2px rgba(0, 255, 255, 0.7)';
        currentState = (currentState + 1) % totalStates;
      } else if (isEnigmaxLeft) {
        leds.forEach(led => {
          led.className = 'led';
        });
        if (currentState < 3) {
          leds[currentState].classList.add('red');
        } else if (currentState < 6) {
          leds[currentState - 3].classList.add('green');
        } else if (currentState < 9) {
          leds[currentState - 6].classList.add('amber');
        }
        currentState = (currentState + 1) % totalStates;
      } else {
        leds.forEach(led => {
          led.className = 'led';
        });
        switch (currentState) {
          case 0:
            leds[0].classList.add('red');
            break;
          case 1:
            leds[1].classList.add('red');
            break;
          case 2:
            leds[2].classList.add('red');
            break;
          case 3:
            leds[0].classList.add('green');
            break;
          case 4:
            leds[1].classList.add('green');
            break;
          case 5:
            leds[2].classList.add('green');
            break;
          case 6:
            break;
        }
        currentState = (currentState + 1) % 7;
      }
    });
  });
  function getPedalExtension(pedalName) {
    const extensionMap = {
      'Cream \'65': 'cream',
      'Rigby \'63': 'rigby',
      'Leo \'68': 'leo',
      'Willow \'55': 'willow',
      'Enigmax': 'enigmax',
      'Herakles': 'herakles',
      'Aint': 'aint'
    };
    return extensionMap[pedalName];
  }
  function validatePedalFile(pedalName, fileName) {
    const expectedExt = getPedalExtension(pedalName);
    return fileName.toLowerCase().endsWith(`.${expectedExt}`);
  }
  document.querySelectorAll('.save-button').forEach(button => {
    button.addEventListener('click', async function () {
      const pedal = button.closest('.pedal');
      const pedalName = pedal.querySelector('h2').textContent.trim();
      const pedalExtension = getPedalExtension(pedalName);
      const pedalImage = pedal.querySelector('.pedal-image');
      try {
        const canvas = await html2canvas(pedalImage, {
          backgroundColor: '#1a1a1a',
          scale: 2,
          logging: false
        });
        const settings = {
          pedalName: pedalName,
          knobPositions: Array.from(pedal.querySelectorAll('.knob')).map(knob => ({
            param: knob.dataset.param,
            rotation: knob.dataset.rotation || '0',
            top: knob.closest('.knob-container').style.top,
            left: knob.closest('.knob-container').style.left
          })),
          ledStates: Array.from(pedal.querySelectorAll('.led')).map(led => ({
            className: led.className
          }))
        };
        canvas.toBlob(async function (imageBlob) {
          const zip = new JSZip();
          zip.file('settings.json', JSON.stringify(settings));
          zip.file('preview.png', imageBlob);
          const zipContent = await zip.generateAsync({
            type: 'blob',
            mimeType: `application/x-${pedalExtension}`
          });
          const timestamp = new Date().toISOString().replace(/[:.]/g, '-');
          const fileName = `UAudio-${settings.pedalName}-${timestamp}.${pedalExtension}`.replace(/\s+/g, '-');
          const link = document.createElement('a');
          link.download = fileName;
          if (/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)) {
            const blob = new Blob([zipContent], {
              type: `application/x-${pedalExtension}`
            });
            link.href = URL.createObjectURL(blob);
          } else {
            link.href = URL.createObjectURL(zipContent);
          }
          link.click();
          URL.revokeObjectURL(link.href);
        }, 'image/png', 1.0);
      } catch (error) {
        console.error('Error generating save file:', error);
        alert('Sorry, there was an error saving the settings. Please try again.');
      }
    });
  });
  document.querySelectorAll('.import-button').forEach(button => {
    const fileInput = button.closest('.button-group').querySelector('.import-input');
    button.addEventListener('click', () => {
      fileInput.click();
    });
    fileInput.addEventListener('change', async e => {
      const file = e.target.files[0];
      if (!file) return;
      try {
        const zip = await JSZip.loadAsync(file);
        const settingsJson = await zip.file('settings.json').async('text');
        const settings = JSON.parse(settingsJson);
        const pedal = Array.from(document.querySelectorAll('.pedal')).find(p => p.querySelector('h2').textContent.trim() === settings.pedalName);
        if (!pedal) {
          throw new Error('No matching pedal found');
        }
        if (!validatePedalFile(settings.pedalName, file.name)) {
          alert(`Invalid file format. This pedal only accepts .${getPedalExtension(settings.pedalName)} files.`);
          return;
        }
        const presetName = file.name.split('.')[0];
        pedal.querySelector('.preset-name').textContent = presetName;
        settings.knobPositions.forEach(knobSetting => {
          const knob = pedal.querySelector(`[data-param="${knobSetting.param}"]`);
          if (knob) {
            knob.dataset.rotation = knobSetting.rotation;
            knob.style.transform = `rotate(${knobSetting.rotation}deg)`;
            const knobContainer = knob.closest('.knob-container');
            knobContainer.style.top = knobSetting.top;
            knobContainer.style.left = knobSetting.left;
          }
        });
        const leds = pedal.querySelectorAll('.led');
        settings.ledStates.forEach((ledState, idx) => {
          if (leds[idx]) {
            leds[idx].className = ledState.className;
          }
        });
        pedal.scrollIntoView({
          behavior: 'smooth',
          block: 'center'
        });
      } catch (error) {
        console.error('Error importing settings:', error);
        alert('Error importing settings. Please make sure this is a valid settings file.');
      }
      fileInput.value = '';
    });
  });
  const favoritesContainer = document.querySelector('.favorites-container');
  const pedalContainer = document.querySelector('.pedal-container');
  const favoritesGrid = document.querySelector('.favorites-grid');
  const pedalFavorites = JSON.parse(localStorage.getItem('pedal-favorites')) || {};
  document.querySelectorAll('.add-favorite-button').forEach(button => {
    button.addEventListener('click', async function () {
      const pedal = button.closest('.pedal');
      const pedalImage = pedal.querySelector('.pedal-image');
      const pedalName = pedal.querySelector('h2').textContent.trim();
      if (!pedalFavorites[pedalName]) {
        pedalFavorites[pedalName] = [];
      }
      const customName = prompt('Enter a name for this favorite:', '');
      if (customName === null) return;
      try {
        const canvas = await html2canvas(pedalImage, {
          backgroundColor: '#1a1a1a',
          scale: 2,
          logging: false
        });
        const imageData = canvas.toDataURL('image/jpeg', 1.0);
        const timestamp = new Date().toLocaleString();
        pedalFavorites[pedalName].push({
          name: pedalName,
          customName: customName,
          image: imageData,
          timestamp: timestamp,
          settings: {
            knobPositions: Array.from(pedal.querySelectorAll('.knob')).map(knob => ({
              param: knob.dataset.param,
              rotation: knob.dataset.rotation || '0',
              top: knob.closest('.knob-container').style.top,
              left: knob.closest('.knob-container').style.left
            })),
            ledStates: Array.from(pedal.querySelectorAll('.led')).map(led => ({
              className: led.className
            }))
          }
        });
        localStorage.setItem('pedal-favorites', JSON.stringify(pedalFavorites));
        alert('Added to favorites!');
      } catch (error) {
        console.error('Error saving favorite:', error);
        alert('Sorry, there was an error saving to favorites. Please try again.');
      }
    });
  });
  document.querySelectorAll('.show-favorites-button').forEach(button => {
    button.addEventListener('click', () => {
      const pedal = button.closest('.pedal');
      const pedalName = pedal.querySelector('h2').textContent.trim();
      pedalContainer.style.display = 'none';
      favoritesContainer.style.display = 'block';
      const favoritesHeader = document.querySelector('.favorites-header h1');
      favoritesHeader.textContent = `${pedalName} Favorites`;
      favoritesGrid.innerHTML = '';
      const pedalFavoritesList = pedalFavorites[pedalName] || [];
      pedalFavoritesList.forEach((favorite, index) => {
        const favoriteItem = document.createElement('div');
        favoriteItem.className = 'favorite-item';
        favoriteItem.innerHTML = `
          <img src="${favorite.image}" alt="${favorite.name}">
          <h3 class="favorite-title">${favorite.customName || favorite.name}</h3>
          <p class="favorite-timestamp">${favorite.timestamp}</p>
          <button class="delete-favorite" data-index="${index}">×</button>
        `;
        favoritesGrid.appendChild(favoriteItem);
        favoriteItem.addEventListener('dblclick', () => {
          const favorite = pedalFavorites[pedalName][index];
          favoritesContainer.style.display = 'none';
          pedalContainer.style.display = 'flex';
          const targetPedal = Array.from(document.querySelectorAll('.pedal')).find(p => p.querySelector('h2').textContent.trim() === pedalName);
          if (targetPedal) {
            targetPedal.querySelector('.preset-name').textContent = favorite.customName || favorite.name;
            favorite.settings.knobPositions.forEach(knobSetting => {
              const knob = targetPedal.querySelector(`[data-param="${knobSetting.param}"]`);
              if (knob) {
                knob.dataset.rotation = knobSetting.rotation;
                knob.style.transform = `rotate(${knobSetting.rotation}deg)`;
                const knobContainer = knob.closest('.knob-container');
                knobContainer.style.top = knobSetting.top;
                knobContainer.style.left = knobSetting.left;
              }
            });
            const leds = targetPedal.querySelectorAll('.led');
            favorite.settings.ledStates.forEach((ledState, idx) => {
              if (leds[idx]) {
                leds[idx].className = ledState.className;
              }
            });
            targetPedal.scrollIntoView({
              behavior: 'smooth',
              block: 'center'
            });
          }
        });
      });
      document.querySelectorAll('.delete-favorite').forEach(deleteButton => {
        deleteButton.addEventListener('click', e => {
          const index = parseInt(e.target.dataset.index);
          if (confirm('Are you sure you want to delete this favorite?')) {
            pedalFavorites[pedalName].splice(index, 1);
            localStorage.setItem('pedal-favorites', JSON.stringify(pedalFavorites));
            button.click();
          }
        });
      });
    });
  });
  document.querySelector('.back-button').addEventListener('click', () => {
    favoritesContainer.style.display = 'none';
    pedalContainer.style.display = 'flex';
  });
  document.querySelector('.export-all-button').addEventListener('click', async function () {
    const currentPedalName = document.querySelector('.favorites-header h1').textContent.replace(' Favorites', '').trim();
    const currentFavorites = pedalFavorites[currentPedalName] || [];
    if (currentFavorites.length === 0) {
      alert('No favorites to export!');
      return;
    }
    for (const favorite of currentFavorites) {
      try {
        const zip = new JSZip();
        const imageData = favorite.image.split(',')[1];
        const imageBlob = await fetch(`data:image/jpeg;base64,${imageData}`).then(r => r.blob());
        zip.file('settings.json', JSON.stringify({
          pedalName: favorite.name,
          knobPositions: favorite.settings.knobPositions,
          ledStates: favorite.settings.ledStates
        }));
        zip.file('preview.png', imageBlob);
        const extension = getPedalExtension(favorite.name);
        const zipContent = await zip.generateAsync({
          type: 'blob',
          mimeType: `application/x-${extension}`
        });
        const link = document.createElement('a');
        const fileName = `UAudio-${favorite.customName || `${favorite.name}-${favorite.timestamp}`}.${extension}`.replace(/[^a-z0-9-]/gi, '_').replace(/_cream$/i, '.cream').replace(/_rigby$/i, '.rigby').replace(/_leo$/i, '.leo').replace(/_willow$/i, '.willow').replace(/_enigmax$/i, '.enigmax').replace(/_herakles$/i, '.herakles').replace(/_aint$/i, '.aint');
        link.download = fileName;
        link.href = URL.createObjectURL(zipContent);
        link.click();
        URL.revokeObjectURL(link.href);
        await new Promise(resolve => setTimeout(resolve, 500));
      } catch (error) {
        console.error('Error exporting favorite:', error);
        alert(`Error exporting favorite "${favorite.customName}". Please try again.`);
      }
    }
    alert('Export complete!');
  });
});</script>
</body></html>